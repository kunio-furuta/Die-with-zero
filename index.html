<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ãƒ€ã‚¤ãƒ»ã‚¦ã‚£ã‚ºãƒ»ã‚¼ãƒ­</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.1/chart.umd.min.js"></script>
<style>
  * { box-sizing: border-box; margin: 0; padding: 0; }
  body {
    font-family: 'Hiragino Kaku Gothic ProN', 'Meiryo', sans-serif;
    background: linear-gradient(135deg, #0f0c29, #302b63, #24243e);
    min-height: 100vh; color: #fff; padding: 20px;
  }
  .header { text-align: center; padding: 30px 0 20px; }
  .header h1 {
    font-size: 2.2rem; font-weight: 900;
    background: linear-gradient(90deg, #f7971e, #ffd200);
    -webkit-background-clip: text; -webkit-text-fill-color: transparent;
  }
  .header p { color: #aaa; margin-top: 8px; font-size: 0.9rem; }
  .container { max-width: 1100px; margin: 0 auto; }
  .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px; }
  @media (max-width: 700px) {
    .grid { grid-template-columns: 1fr; }
    .summary { grid-template-columns: 1fr 1fr !important; }
    .header h1 { font-size: 1.6rem; }
  }
  .card { background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); border-radius: 16px; padding: 20px; }
  .card h2 { font-size: 1rem; color: #ffd200; margin-bottom: 16px; }
  .form-group { margin-bottom: 14px; }
  label { display: block; font-size: 0.8rem; color: #bbb; margin-bottom: 4px; }

  /* ã‚«ãƒ³ãƒä»˜ãå…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ */
  .input-wrap { position: relative; }
  .input-wrap .unit { position: absolute; right: 10px; top: 50%; transform: translateY(-50%); color: #888; font-size: 0.8rem; pointer-events: none; }
  input.comma-input {
    width: 100%; padding: 9px 36px 9px 12px; border-radius: 8px;
    border: 1px solid rgba(255,255,255,0.15);
    background: rgba(255,255,255,0.08); color: #fff;
    font-size: 0.95rem; outline: none; text-align: right;
  }
  input.comma-input:focus { border-color: #ffd200; }
  input.plain-input {
    width: 100%; padding: 9px 36px 9px 12px; border-radius: 8px;
    border: 1px solid rgba(255,255,255,0.15);
    background: rgba(255,255,255,0.08); color: #fff;
    font-size: 0.95rem; outline: none; text-align: right;
  }
  input.plain-input:focus { border-color: #ffd200; }
  input[type="text"].name-input {
    width: 100%; padding: 9px 12px; border-radius: 8px;
    border: 1px solid rgba(255,255,255,0.15);
    background: rgba(255,255,255,0.08); color: #fff;
    font-size: 0.95rem; outline: none;
  }
  input[type="text"].name-input:focus { border-color: #ffd200; }

  /* å‰¯æ¥­ã‚»ã‚¯ã‚·ãƒ§ãƒ³ */
  .side-job-section { background: rgba(255,255,255,0.03); border: 1px solid rgba(255,255,255,0.08); border-radius: 12px; padding: 14px; margin-top: 12px; }
  .side-job-section h3 { font-size: 0.85rem; color: #74c0fc; margin-bottom: 12px; }
  .age-range { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }

  .extra-item { display: flex; gap: 8px; margin-bottom: 8px; }
  .extra-item input[type="text"] { flex: 1.5; }
  .extra-item .comma-wrap { flex: 1; position: relative; }
  .extra-item .comma-wrap input { width: 100%; padding: 9px 30px 9px 12px; border-radius: 8px; border: 1px solid rgba(255,255,255,0.15); background: rgba(255,255,255,0.08); color: #fff; font-size: 0.95rem; outline: none; text-align: right; }
  .extra-item .comma-wrap input:focus { border-color: #ffd200; }
  .extra-item .comma-wrap .unit { position: absolute; right: 8px; top: 50%; transform: translateY(-50%); color: #888; font-size: 0.75rem; pointer-events: none; }
  .btn-del { background: rgba(255,80,80,0.3); border: none; color: #ff8080; border-radius: 8px; padding: 0 12px; cursor: pointer; font-size: 1rem; }
  .btn-del:hover { background: rgba(255,80,80,0.6); }
  .btn-add { background: rgba(255,210,0,0.12); border: 1px dashed rgba(255,210,0,0.5); color: #ffd200; border-radius: 8px; padding: 8px 16px; cursor: pointer; font-size: 0.85rem; width: 100%; margin-top: 4px; }
  .btn-add:hover { background: rgba(255,210,0,0.22); }

  .summary { display: grid; grid-template-columns: repeat(4,1fr); gap: 16px; margin-bottom: 20px; }
  .summary-card { background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); border-radius: 14px; padding: 16px; text-align: center; }
  .summary-card .slabel { font-size: 0.75rem; color: #aaa; margin-bottom: 6px; }
  .summary-card .value { font-size: 1.4rem; font-weight: 700; }
  .gold { color: #ffd200; } .red { color: #ff6b6b; } .green { color: #51cf66; }
  .chart-card { background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); border-radius: 16px; padding: 20px; margin-bottom: 20px; }
  .chart-card h2 { font-size: 1rem; color: #ffd200; margin-bottom: 16px; }
  .warn-banner { background: rgba(255,80,80,0.15); border: 1px solid rgba(255,80,80,0.4); border-radius: 10px; padding: 12px 18px; color: #ff8080; font-size: 0.9rem; margin-bottom: 16px; display: none; }
  .footer { text-align: center; color: #555; font-size: 0.75rem; padding: 20px 0; }
  .divider { border: none; border-top: 1px solid rgba(255,255,255,0.08); margin: 12px 0; }
</style>
</head>
<body>
<div class="container">
  <div class="header">
    <h1>ğŸ’€ ãƒ€ã‚¤ãƒ»ã‚¦ã‚£ã‚ºãƒ»ã‚¼ãƒ­</h1>
    <p>æ­»ã¬ã¨ãã«è³‡ç”£ã‚’ã‚¼ãƒ­ã«ã™ã‚‹ â€” äººç”Ÿã‚’æœ€å¤§é™ã«è±Šã‹ã«ä½¿ã†ãŸã‚ã®è¨ˆç®—ãƒ„ãƒ¼ãƒ«</p>
  </div>
  <div id="warnBanner" class="warn-banner"></div>
  <div class="summary">
    <div class="summary-card"><div class="slabel">ä»Šæ—¥ä½¿ãˆã‚‹é‡‘é¡</div><div class="value gold" id="sumDaily">â€”</div><div style="font-size:0.75rem;color:#888">å††/æ—¥</div></div>
    <div class="summary-card"><div class="slabel">100æ­³æ™‚ã®è³‡ç”£ or ã‚¼ãƒ­å¹´é½¢</div><div class="value" id="sumZeroAge">â€”</div></div>
    <div class="summary-card"><div class="slabel">ç”Ÿæ¶¯ç·åå…¥</div><div class="value green" id="sumTotalIncome">â€”</div><div style="font-size:0.75rem;color:#888">å††</div></div>
    <div class="summary-card"><div class="slabel">ç”Ÿæ¶¯ç·æ”¯å‡º</div><div class="value red" id="sumTotalExpense">â€”</div><div style="font-size:0.75rem;color:#888">å††</div></div>
  </div>

  <div class="grid">
    <!-- åŸºæœ¬æƒ…å ± -->
    <div class="card">
      <h2>ğŸ‘¤ åŸºæœ¬æƒ…å ±</h2>
      <div class="form-group">
        <label>ç¾åœ¨ã®å¹´é½¢ï¼ˆæ­³ï¼‰</label>
        <div class="input-wrap"><input class="plain-input" type="text" id="age" value="40"><span class="unit">æ­³</span></div>
      </div>
      <div class="form-group">
        <label>ç¾åœ¨ã®ç·è³‡ç”£ï¼ˆå††ï¼‰</label>
        <div class="input-wrap"><input class="comma-input" type="text" id="assets" value="10,000,000"><span class="unit">å††</span></div>
      </div>
      <div class="form-group">
        <label>è³‡ç”£é‹ç”¨åˆ©å›ã‚Šï¼ˆ%/å¹´ï¼‰</label>
        <div class="input-wrap"><input class="plain-input" type="text" id="returnRate" value="3"><span class="unit">%</span></div>
      </div>
    </div>

    <!-- åå…¥ -->
    <div class="card">
      <h2>ğŸ’° åå…¥</h2>
      <div class="form-group">
        <label>ç¾åœ¨ã®å¹´åï¼ˆå††/å¹´ï¼‰</label>
        <div class="input-wrap"><input class="comma-input" type="text" id="annualIncome" value="6,500,000"><span class="unit">å††</span></div>
      </div>
      <div class="form-group">
        <label>å°±åŠ´çµ‚äº†å¹´é½¢ï¼ˆæ­³ï¼‰</label>
        <div class="input-wrap"><input class="plain-input" type="text" id="retireAge" value="65"><span class="unit">æ­³</span></div>
      </div>
      <hr class="divider">
      <div class="form-group">
        <label>å¹´é‡‘å—çµ¦é–‹å§‹å¹´é½¢ï¼ˆæ­³ï¼‰</label>
        <div class="input-wrap"><input class="plain-input" type="text" id="pensionStartAge" value="65"><span class="unit">æ­³</span></div>
      </div>
      <div class="form-group">
        <label>å¹´é‡‘å—çµ¦é¡ï¼ˆå††/æœˆï¼‰</label>
        <div class="input-wrap"><input class="comma-input" type="text" id="pensionMonthly" value="150,000"><span class="unit">å††</span></div>
      </div>

      <!-- å‰¯æ¥­ -->
      <div class="side-job-section">
        <h3>ğŸ’¼ å‰¯æ¥­åå…¥</h3>
        <div class="age-range">
          <div class="form-group">
            <label>å‰¯æ¥­ é–‹å§‹å¹´é½¢</label>
            <div class="input-wrap"><input class="plain-input" type="text" id="sideStartAge" value="40"><span class="unit">æ­³</span></div>
          </div>
          <div class="form-group">
            <label>å‰¯æ¥­ çµ‚äº†å¹´é½¢</label>
            <div class="input-wrap"><input class="plain-input" type="text" id="sideEndAge" value="70"><span class="unit">æ­³</span></div>
          </div>
        </div>
        <div class="form-group">
          <label>å‰¯æ¥­ã®å¹´åå…¥é¡ï¼ˆå††/å¹´ï¼‰</label>
          <div class="input-wrap"><input class="comma-input" type="text" id="sideIncome" value="1,000,000"><span class="unit">å††</span></div>
        </div>
      </div>
    </div>

    <!-- æ¯æœˆã®æ”¯å‡º -->
    <div class="card">
      <h2>ğŸ  æ¯æœˆã®æ”¯å‡º</h2>
      <div class="form-group">
        <label>å®¶è³ƒãƒ»ä½å±…è²»ï¼ˆå††/æœˆï¼‰</label>
        <div class="input-wrap"><input class="comma-input" type="text" id="rent" value="80,000"><span class="unit">å††</span></div>
      </div>
      <div class="form-group">
        <label>æ¯æœˆã®ç”Ÿæ´»è²»ï¼ˆå††/æœˆï¼‰</label>
        <div class="input-wrap"><input class="comma-input" type="text" id="living" value="150,000"><span class="unit">å††</span></div>
      </div>
    </div>

    <!-- ç‰¹åˆ¥ãƒ»ãã®ä»–æ”¯å‡º -->
    <div class="card">
      <h2>âœˆï¸ å¹´é–“ã®ç‰¹åˆ¥æ”¯å‡ºãƒ»ãã®ä»–</h2>
      <div class="form-group">
        <label>ç‰¹åˆ¥ãªå‡ºè²»ï¼ˆå††/å¹´ï¼‰</label>
        <div class="input-wrap"><input class="comma-input" type="text" id="special" value="500,000"><span class="unit">å††</span></div>
      </div>
      <div id="extraItems"></div>
      <button class="btn-add" onclick="addExtraItem()">ï¼‹ ãã®ä»–è²»ç›®ã‚’è¿½åŠ </button>
    </div>
  </div>

  <div class="chart-card"><h2>ğŸ“ˆ è³‡ç”£æ¨ç§»ï¼ˆç¾åœ¨ã€œ100æ­³ï¼‰</h2><canvas id="assetChart" height="80"></canvas></div>
  <div class="chart-card"><h2>ğŸ“… 1æ—¥ã‚ãŸã‚Šã«ä½¿ãˆã‚‹é‡‘é¡ã®æ¨ç§»</h2><canvas id="dailyChart" height="80"></canvas></div>
  <div class="footer">â€» ã“ã®ãƒ„ãƒ¼ãƒ«ã¯ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã§ã™ã€‚å®Ÿéš›ã®ç¨é‡‘ãƒ»ã‚¤ãƒ³ãƒ•ãƒ¬ç­‰ã¯è€ƒæ…®ã—ã¦ã„ã¾ã›ã‚“ã€‚</div>
</div>

<script>
let extraItems = [], assetChart, dailyChart;

// ã‚«ãƒ³ãƒä»˜ãæ•°å€¤å‡¦ç†
function toNum(id) {
  const el = document.getElementById(id);
  if (!el) return 0;
  return parseFloat(el.value.replace(/,/g, '')) || 0;
}

function formatComma(str) {
  const raw = str.replace(/,/g, '').replace(/[^\d]/g, '');
  if (!raw) return '';
  return parseInt(raw, 10).toLocaleString('ja-JP');
}

function attachCommaFormatter(el) {
  if (!el || !el.classList.contains('comma-input')) return;
  el.addEventListener('focus', function() {
    this.value = this.value.replace(/,/g, '');
  });
  el.addEventListener('blur', function() {
    if (this.value) this.value = formatComma(this.value);
    calculate();
  });
  el.addEventListener('input', function() {
    calculate();
  });
}

// åˆæœŸåŒ–æ™‚ã«ã‚«ãƒ³ãƒãƒ•ã‚©ãƒ¼ãƒãƒƒã‚¿ãƒ¼ã‚’ä»˜ä¸
document.querySelectorAll('.comma-input').forEach(el => attachCommaFormatter(el));
document.querySelectorAll('.plain-input').forEach(el => {
  el.addEventListener('input', () => calculate());
});

// ãã®ä»–è²»ç›®
function addExtraItem() {
  extraItems.push({ id: Date.now() });
  renderExtraItems();
  calculate();
}
function removeExtraItem(id) {
  extraItems = extraItems.filter(e => e.id !== id);
  renderExtraItems();
  calculate();
}
function renderExtraItems() {
  document.getElementById('extraItems').innerHTML = extraItems.map(e => `
    <div class="extra-item">
      <input type="text" class="name-input" placeholder="è²»ç›®å" id="ename-${e.id}" oninput="calculate()">
      <div class="comma-wrap">
        <input type="text" placeholder="0" id="eamt-${e.id}"
          onfocus="this.value=this.value.replace(/,/g,'')"
          onblur="this.value=this.value?parseInt(this.value.replace(/,/g,'')).toLocaleString('ja-JP'):'';calculate()"
          oninput="calculate()">
        <span class="unit">å††/å¹´</span>
      </div>
      <button class="btn-del" onclick="removeExtraItem(${e.id})">âœ•</button>
    </div>`).join('');
}

function fmt(n) {
  if (Math.abs(n) >= 1e8) return (n / 1e8).toFixed(1) + 'å„„';
  if (Math.abs(n) >= 1e4) return Math.round(n / 1e4) + 'ä¸‡';
  return Math.round(n).toLocaleString();
}

function calculate() {
  const ca = toNum('age');
  const a0 = toNum('assets');
  const rr = toNum('returnRate') / 100;
  const ai = toNum('annualIncome');
  const ra = toNum('retireAge');
  const psa = toNum('pensionStartAge');
  const pm = toNum('pensionMonthly');
  const sideStart = toNum('sideStartAge');
  const sideEnd = toNum('sideEndAge');
  const sideInc = toNum('sideIncome');

  const extraTotal = extraItems.reduce((s, e) => {
    const el = document.getElementById('eamt-' + e.id);
    return s + (el ? parseFloat(el.value.replace(/,/g, '')) || 0 : 0);
  }, 0);

  const annualExpense = toNum('rent') * 12 + toNum('living') * 12 + toNum('special') + extraTotal;

  const ages = [], ad = [], dd = [];
  let bal = a0, ti = 0, te = 0, za = null;

  for (let age = ca; age <= 100; age++) {
    const mainInc = age < ra ? ai : 0;
    const pensionInc = age >= psa ? pm * 12 : 0;
    const sideJobInc = (age >= sideStart && age <= sideEnd) ? sideInc : 0;
    const income = mainInc + pensionInc + sideJobInc;

    bal = bal * (1 + rr) + income - annualExpense;
    ti += income; te += annualExpense;

    const rem = (100 - age) * 365;
    ages.push(age + 'æ­³');
    ad.push(Math.round(bal));
    dd.push(rem > 0 ? Math.round(bal / rem) : 0);
    if (bal < 0 && !za) za = age;
  }

  const todayRemain = (100 - ca) * 365;
  document.getElementById('sumDaily').textContent = todayRemain > 0 ? Math.round(a0 / todayRemain).toLocaleString() : 'â€”';
  document.getElementById('sumTotalIncome').textContent = fmt(ti);
  document.getElementById('sumTotalExpense').textContent = fmt(te);

  const ze = document.getElementById('sumZeroAge');
  const wb = document.getElementById('warnBanner');
  if (za) {
    ze.textContent = za + 'æ­³ã§ã‚¼ãƒ­'; ze.className = 'value red';
    wb.style.display = 'block'; wb.textContent = `âš ï¸ ${za}æ­³ã§è³‡ç”£ãŒã‚¼ãƒ­ã«ãªã‚Šã¾ã™ã€‚æ”¯å‡ºã‚’è¦‹ç›´ã—ã¦ãã ã•ã„ã€‚`;
  } else {
    ze.textContent = fmt(ad[ad.length - 1]) + 'å††æ®‹'; ze.className = 'value green';
    wb.style.display = 'none';
  }

  const sc = {
    x: { ticks: { color: '#888', maxTicksLimit: 13, font: { size: 11 } }, grid: { color: 'rgba(255,255,255,0.05)' } },
    y: {
      ticks: {
        color: '#888', font: { size: 11 },
        callback: v => Math.abs(v) >= 1e8 ? (v / 1e8).toFixed(0) + 'å„„' : Math.abs(v) >= 1e4 ? Math.round(v / 1e4) + 'ä¸‡' : v
      },
      grid: { color: 'rgba(255,255,255,0.05)' }
    }
  };

  if (assetChart) assetChart.destroy();
  assetChart = new Chart(document.getElementById('assetChart'), {
    type: 'line',
    data: { labels: ages, datasets: [{ data: ad, borderColor: '#ffd200', backgroundColor: 'rgba(255,210,0,0.08)', fill: true, tension: 0.3, pointRadius: 0, borderWidth: 2 }] },
    options: { responsive: true, interaction: { mode: 'index', intersect: false }, plugins: { legend: { display: false }, tooltip: { backgroundColor: 'rgba(0,0,0,0.8)', callbacks: { label: c => ' è³‡ç”£æ®‹é«˜: ' + c.parsed.y.toLocaleString() + ' å††' } } }, scales: sc }
  });

  if (dailyChart) dailyChart.destroy();
  dailyChart = new Chart(document.getElementById('dailyChart'), {
    type: 'line',
    data: { labels: ages, datasets: [{ data: dd, borderColor: '#74c0fc', backgroundColor: 'rgba(116,192,252,0.08)', fill: true, tension: 0.3, pointRadius: 0, borderWidth: 2 }] },
    options: { responsive: true, interaction: { mode: 'index', intersect: false }, plugins: { legend: { display: false }, tooltip: { backgroundColor: 'rgba(0,0,0,0.8)', callbacks: { label: c => ' 1æ—¥ã‚ãŸã‚Š: ' + c.parsed.y.toLocaleString() + ' å††' } } }, scales: sc }
  });
}

calculate();
</script>
</body>
</html>
